# J2KSwift v1.1.1 Development Plan

**Target Release**: 2-4 weeks  
**Release Type**: Patch Release  
**Status**: Planning Phase  
**Started**: 2026-02-14

## Overview

Version 1.1.1 is a patch release focusing on bug fixes, performance optimization, and infrastructure improvements following the successful v1.1.0 release.

## Goals

1. Fix remaining issues (64x64 MQ coder issue)
2. Optimize lossless decoding performance
3. Establish performance benchmarking against OpenJPEG
4. Enhance JPIP integration testing
5. Validate cross-platform compatibility

## Tasks

### Priority 1: Benchmarking Infrastructure ✅ COMPLETE

**Goal**: Enable systematic performance comparison with OpenJPEG

**Status**: Complete

**Completed**:
- [x] Create `Scripts/` directory for development tools
- [x] Implement `benchmark_openjpeg.sh` script for OpenJPEG benchmarking
- [x] Add test image generation
- [x] Add benchmark results to `.gitignore`
- [x] Document script usage in `Scripts/README.md`
- [x] Implement J2KSwift CLI tool for automated benchmarking
- [x] Add encode/decode/benchmark commands with full options
- [x] Implement PGM/PPM image I/O utilities
- [x] Add JSON output format for automated processing
- [x] Integrate CLI tool with benchmark_openjpeg.sh script
- [x] Test benchmarking with multiple image sizes
- [x] Update documentation

**Features Delivered**:
- Full-featured CLI tool with 3 commands (encode, decode, benchmark)
- Support for PGM/PPM image formats
- Encoding presets (fast, balanced, quality)
- Detailed timing and throughput statistics
- JSON output for automated processing
- Integration with comparison benchmarking script

**Files Created/Updated**:
- `Package.swift` - Added J2KCLI executable target
- `Sources/J2KCLI/main.swift` - CLI entry point and command routing
- `Sources/J2KCLI/Commands.swift` - Encode and decode commands
- `Sources/J2KCLI/Benchmark.swift` - Benchmarking command
- `Sources/J2KCLI/ImageIO.swift` - PGM/PPM image loading and saving
- `Scripts/benchmark_openjpeg.sh` - Updated with J2KSwift integration
- `Scripts/README.md` - Updated documentation

**Next Steps**:
- Run baseline benchmarks with different image sizes and quality levels
- Document baseline performance in `REFERENCE_BENCHMARKS.md`
- Compare with OpenJPEG (if available)

**Achievement**: Full CLI infrastructure for performance testing is now available!

### Priority 2: 64x64 Dense Data MQ Coder Issue

**Goal**: Investigate and fix the pre-existing 64x64 block encoding/decoding issue

**Status**: Documented, awaiting investigation

**Background**:
- Issue affects 64x64 code-blocks with dense, high-magnitude data
- 2 tests are currently skipped: `testMinimalBlock64x64`, `test64x64WithoutBypass`
- Well-documented in `LARGE_BLOCK_BUG_2026-02-08.md`
- Root cause: Unknown MQ coder issue at specific block sizes
- Workaround: Use smaller block sizes (≤48x48)

**Investigation Approach**:
1. Create minimal reproducible test case
2. Compare bitstreams between working (48x48) and failing (64x64) cases
3. Step-through debugging of encoding/decoding process
4. Compare against OpenJPEG reference implementation
5. Identify divergence point in MQ coder state

**Estimated Effort**: 1-2 weeks (requires JPEG 2000 expertise)

**Risk**: Low (affects edge case, workarounds available)

### Priority 3: Lossless Decoding Optimization

**Goal**: Optimize packet parsing for lossless decoding performance

**Status**: Not started

**Background**:
- 1 test skipped: `testLosslessRoundTrip`
- Lossless decoding works but needs optimization
- Performance bottleneck in packet parsing

**Approach**:
1. Profile lossless decoding pipeline
2. Identify packet parsing bottlenecks
3. Optimize buffer management
4. Optimize memory allocations
5. Add comprehensive lossless tests

**Estimated Effort**: 3-5 days

**Expected Outcome**: 2-3× faster lossless decoding

### Priority 4: JPIP End-to-End Testing

**Goal**: Add comprehensive JPIP integration tests

**Status**: Not started

**Background**:
- JPIP infrastructure complete in v1.0
- Basic tests exist, but need end-to-end scenarios
- Integration with encoder/decoder needs validation

**Tasks**:
- [ ] Add client-server integration tests
- [ ] Test progressive quality streaming
- [ ] Test ROI streaming
- [ ] Test resolution-level streaming
- [ ] Test cache management
- [ ] Test multi-client scenarios
- [ ] Document JPIP usage patterns

**Estimated Effort**: 1 week

**Expected Outcome**: 15-20 new JPIP integration tests

### Priority 5: Cross-Platform Validation

**Goal**: Ensure J2KSwift works correctly across all supported platforms

**Status**: Not started

**Platforms**:
- ✅ Linux (GitHub Actions runner - primary development)
- ⏳ macOS (Apple Silicon and Intel)
- ⏳ iOS
- ⏳ tvOS
- ⏳ watchOS
- ⏳ Windows

**Tasks**:
- [ ] Set up CI for all platforms
- [ ] Run full test suite on each platform
- [ ] Document platform-specific issues
- [ ] Fix platform-specific bugs
- [ ] Add platform-specific optimizations (vDSP on Apple platforms)

**Estimated Effort**: 1 week

## Timeline

### Week 1 (Feb 14-21, 2026)
- [x] Create benchmarking infrastructure
- [x] Design J2KSwift CLI tool
- [x] Implement J2KSwift CLI tool
- [x] Test benchmark script with OpenJPEG
- [x] Fix CLI integration test failures
- [ ] Begin 64x64 issue investigation

### Week 2 (Feb 21-28, 2026)
- [ ] Run baseline benchmarks
- [ ] Continue 64x64 investigation
- [ ] Begin lossless optimization

### Week 3 (Feb 28-Mar 7, 2026)
- [ ] Complete lossless optimization
- [ ] Add JPIP integration tests
- [ ] Begin cross-platform validation
- [ ] Document findings

### Week 4 (Mar 7-14, 2026)
- [ ] Complete cross-platform validation
- [ ] Fix identified issues
- [ ] Update documentation
- [ ] Prepare v1.1.1 release

## Success Criteria

v1.1.1 will be considered successful when:

- [x] Benchmarking infrastructure is functional and documented
- [x] CLI tool is fully implemented and tested
- [ ] Baseline performance metrics are established
- [ ] 64x64 issue is either fixed or thoroughly documented with workarounds
- [ ] Lossless decoding shows measurable performance improvement
- [ ] JPIP has 15+ integration tests
- [ ] All platforms have been validated
- [ ] Documentation is updated
- [x] All tests pass (or are documented as expected failures)

## Documentation Updates

Files to update for v1.1.1:
- [ ] `REFERENCE_BENCHMARKS.md` - Add baseline measurements
- [ ] `LARGE_BLOCK_BUG_2026-02-08.md` - Update with findings
- [ ] `ROADMAP_v1.1.md` - Mark completed tasks
- [ ] `RELEASE_NOTES_v1.1.1.md` - Create release notes
- [ ] `README.md` - Update status and test counts
- [ ] `VERSION` - Update to 1.1.1

## Risk Assessment

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| 64x64 issue complexity | High | Medium | Document workarounds, defer if needed |
| OpenJPEG unavailable | Medium | Low | Script has --no-openjpeg option |
| Platform-specific bugs | Medium | Medium | Prioritize critical platforms |
| Timeline overrun | Medium | Low | Flexible scope, can defer tasks |

## Dependencies

- OpenJPEG (optional, for benchmarking)
- Swift 6.2+
- GitHub Actions runners (for CI)
- Platform access (macOS, iOS, etc.)

## Notes

- This is a patch release, no breaking changes allowed
- Focus on stability and performance
- All changes must maintain backward compatibility
- Documentation is as important as code changes

---

**Created**: 2026-02-14  
**Last Updated**: 2026-02-14  
**Status**: ✅ Planning Phase  
**Next Review**: Week 2 (Feb 21, 2026)
